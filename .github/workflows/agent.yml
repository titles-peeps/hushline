name: Agent â€“ Pass Issue To LLM
on:
  issues:
    types: [labeled]

jobs:
  run-agent:
    if: ${{ github.event.label.name == 'agent' }}
    runs-on: self-hosted
    permissions:
      contents: write
      issues: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Verify prerequisites
        run: |
          command -v jq >/dev/null 2>&1 || { echo "jq required"; exit 1; }
          command -v curl >/dev/null 2>&1 || { echo "curl required"; exit 1; }

      - name: Run local agent (send title/body to LLM; comment back)
        env:
          AGENT_TOKEN: ${{ secrets.AGENT_TOKEN }}
        run: |
          bash ops/agent.sh
